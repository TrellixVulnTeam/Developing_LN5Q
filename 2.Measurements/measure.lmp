# Set Thermodynamic parameters
variable T		equal	0.846091996
variable P		equal	0.012173254
variable nrun		equal 	30000000
variable nrestart 	equal 	${nrun}/5

# Setting units and styles
boundary	p p s
units		lj
atom_style	bond
bond_style	harmonic
pair_style	lj/cut 4

read_restart	../1.Equilibrate/equilibrate.conf
reset_timestep 0

bond_coeff	1 2500	1.16258254322


# For atom pairs, specify lj parameters
pair_coeff	1 1 1.0 1.0 4.0
pair_coeff	2 2 1.0 1.0 4.0
pair_coeff	3 3 1.0 1.0 4.0
pair_coeff	4 4 1.0 1.0 4.0

pair_coeff	1 2 1.0 1.0 4.0
pair_coeff	1 3 0.55 1.0 4.0
pair_coeff	1 4 1.0 1.0 4.0

pair_coeff	2 3 1.1 1.0 4.0
pair_coeff	2 4 1.0 1.0 4.0
neighbor	0.3 bin
neigh_modify	every 20 delay 0 check no
pair_modify	shift yes

# Variables for Box Dimensions
variable	Lx	equal	xhi-xlo
variable	Ly	equal	yhi-ylo
variable	Lz	equal	zhi-zlo

# Variables for top and bottom bounds, fluid length scale
variable	zlo_top	equal bound(top,zmin)
variable	zhi_sub	equal bound(sub,zmax)
variable	Lz_fluid equal ${zlo_top}-${zhi_sub}

# Setting variables for vx of top, bottom, and fluid
variable	Vx_fluid equal vcm(fluid,x)
variable	Vx_top	 equal vcm(top,x)
variable	Vx_sub	 equal vcm(sub,x)
variable 	Vx_subedge equal vcm(subedge,x)

# Defining computes for simulation
# Compute temperature of solid and fluid

compute		cTfluid	fluid	temp/com
compute		cTsolid	solid	temp/com
compute		cP	all	pressure	thermo_temp

# Compute per atom quantities of fluid
compute		pe	fluid	pe/atom

# Compute kinetic energy per atom
compute		ke	fluid	ke/atom
variable	temp	atom	c_ke/1.5

# Timestep and thermal output parameters
timestep	0.001
thermo		1000

thermo_style	custom step v_Vx_fluid v_Vx_top v_Vx_sub c_cTfluid c_cTsolid vol press v_Lz pzz lz v_Vx_subedge
thermo_modify	flush yes

# Fixes for fluid temperature 
fix		fNVTfluid fluid nvt temp 0.846091996 0.846091996 0.1
fix_modify	fNVTfluid temp cTfluid

# Fixes for temperature 
fix		fNVTsolid solid nvt temp 0.846091996 0.846091996 0.1
fix_modify	fNVTsolid temp cTsolid	

# Fixing the lower layer

velocity	subedge set 0.0 0.0 0.0
fix  		LowLayer subedge setforce 0.0 0.0 0.0 

# Set forces for top piston
variable	Fz_piston equal -1*(${P}*${Lx}*${Ly})/count(top)
fix		Fix_Piston top addforce 0 0 ${Fz_piston}

# Defining stress compute and spatial averaging
compute		str	fluid	stress/atom cTfluid
compute		chunk1 fluid chunk/atom bin/1d z lower 0.05 bound z 5.0 20.0 units box

fix		fstress fluid ave/chunk 1 10000 10000 chunk1 vx density/mass v_temp c_ke c_pe c_str[1] c_str[3] file properties.all

# Defining density compute for A and B and spatial averaging
compute		chunk_A A chunk/atom bin/1d z lower 0.05 bound z 5.0 20.0 units box

fix		f_A A ave/chunk 1 10000 10000 chunk_A vx density/mass file Lproperties.all

compute		chunk_B B chunk/atom bin/1d z lower 0.05 bound z 5.0 20.0 units box

fix		f_B B ave/chunk 1 10000 10000 chunk_B vx density/mass file Sproperties.all

dump 		1 all xyz ${nrun} trajectory.xyz
restart 	${nrestart} measurement.conf
run		${nrun}
