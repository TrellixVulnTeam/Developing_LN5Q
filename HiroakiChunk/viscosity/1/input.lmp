#Simulating 1000 N2 molecules
variable 	myRun equal 2e6
variable 	myEq  equal 4e5
variable 	myDump equal 100
variable 	myStep equal 10
variable 	myTemp equal 273.15
variable 	myThermo equal 1000
# ------------------------------- Initialization Section --------------------
atom_style full
units real
pair_style lj/sf 8.0
pair_modify tail yes
pair_modify mix geometric
#bond_style      harmonic
# ------------------------------- Atom Definition Section -------------------

# Reads a crystalline array array of methane (10x10x10)

read_data       "system.data"

# ------------------------------- Settings Section --------------------------

pair_coeff 1 1 0.122412 3.31
#bond_coeff 1 5000.00 1.1

# ------------------------------- Run Equilibration -------------------------------
group nitrogen type 1
velocity nitrogen create ${myTemp} 432567 dist uniform

timestep        ${myStep}
# -- minimization protocol --

# Note: The minimization step is not necessary in this example.  However
#       in general, it's always a good idea to minimize the system beforehand.
#       (The "fShakeSPCE" fix was defined in system.in.settings. 
#        It is incompatible with "minimize", so we disable it first.)
#unfix         fShakeSPCE



# ------------------------------- Run NVT Section -------------------------------
# -- simulation protocol --

neighbor 0.5 bin
neigh_modify delay 0 every 1 check yes
#neigh_modify exclude molecule/intra all

#compute 	1 all pressure thermo_temp ke
fix             fxnvt all rigid/nvt molecule temp ${myTemp} ${myTemp} 100


thermo        ${myThermo}
thermo_style custom step temp pe ke etotal press pxy

run 		${myEq}


# Computation of the viscosity on the flight
variable    ps equal 400     # correlation length\
variable    ss equal 5       # sample interval
variable    ds equal ${ps}*${ss}   # dump interval


include 	in.computations

#dump            nvt_traj all custom ${myDump} traj_nvt.lammpstrj id mol type x y z
#dump            per_image all custom ${myDump} per_image.dat id type ix iy iz
#dump 		dcd_file all dcd ${myDump} dcd_nvt.dcd


fix              SS all ave/correlate ${ss} ${ps} ${ds} v_pxy v_pxz v_pyz v_pxx type auto file profile.gk.2d ave running


# convert from LAMMPS real units to SI

variable    kB equal 1.380649e-23   # [J/K] Boltzmann
variable    atm2Pa equal 101325.0
variable    A2m equal 1.0e-10
variable    fs2s equal 1.0e-15
variable    convert equal ${atm2Pa}*${atm2Pa}*${fs2s}*${A2m}*${A2m}*${A2m}

variable     scale equal ${convert}/(${kB}*${myTemp})*vol*${ss}*dt
variable     dim equal 3
variable         diagfac equal 2-2/${dim}
variable         vxy equal trap(f_SS[3])*${scale}
variable         vxz equal trap(f_SS[4])*${scale}
variable         vyz equal trap(f_SS[5])*${scale}
variable         vxx equal trap(f_SS[6])*${scale}/${diagfac}

thermo_style     custom step temp press v_vxy v_vxz v_vyz v_vxx


thermo		${ds}
run             ${myRun}

variable         etaxy equal v_vxy
variable         etaxz equal v_vxz
variable         etayz equal v_vyz
variable         etaxx equal v_vxx     
variable         eta equal (${etaxy}+${etaxz}+${etayz}+${etaxx})/4


print        "average viscosity: ${eta} [Pa.s]"

